# Note: adapted from Howard Pritchard's examples

[MTTDefaults]
scratchdir = test_scratch
description = Trivial Runtime testing
platform = TJN-beaker
executor = sequential

[Profile:Installed]

#======================================================================
# Middleware construction phases - get the middleware, build, and
# install it. This isn't a required phase - if the purpose of this test
# is to simply stress the physical system, then one can skip this phase
#======================================================================

[MiddlewareGet:OMPIMaster]
plugin = AlreadyInstalled
#exec =  /ccs/home/howardp/ompi/install/bin/mpicc
exec =  /ssd/tjn/scratch/ompi-scratch/QUICK-YAK/ompi/build-std/_install/bin/mpicc


#----------------------------------------------------------------------

#======================================================================
# Test construction phases - get and build the tests that the
# target software will run.
#======================================================================


[ASIS TestGet:HelloWorld]
plugin = Copytree
src = /home/3t4/projects/mtt/MTT-PMIX/mtt/samples/python/

#======================================================================
# Test build phase
#======================================================================

[TestBuild:HelloWorld]
parent = TestGet:HelloWorld
plugin = Shell

# Use our built ompi install
middleware = MiddlewareBuild:OMPI
command = mpicc mpi_hello_world.c -o mpi_hello_world

#======================================================================
# Define some default launcher execution parameters
#======================================================================

[LauncherDefaults:OMPI]
plugin = OpenMPI
command = mpirun
options = --show-progress
timeout = 120
#np = 16
#ppn = 8
np = 6
ppn = 6

skipped = 77
merge_stdout_stderr = 1
stdout_save_lines = 100
stderr_save_lines = 100

#======================================================================
# Test run phase - the executor will automatically change directory to
# the top directory where the tests were installed, so any search for
# executables will take place relative to that point
#======================================================================

[TestRun:HelloWorld]
plugin = OpenMPI
parent = TestBuild:HelloWorld
test_list = mpi_hello_world
timeout = 120

#======================================================================
# Reporter phase
#======================================================================

#[Reporter:Console]
#plugin = TextFile

#[Reporter: text file backup]
[Reporter: text]
plugin = TextFile
filename = mttresults.txt
summary_footer =
detail_header  =
detail_footer  =
textwrap = 78
